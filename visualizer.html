<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .pui-components-http-request-result-visualize-frame-index-visualize-frame{
      width: 90vw;
      height: 90vh;
      border: none;
    }
  </style>
</head>
<body>

<iframe class="pui-components-http-request-result-visualize-frame-index-visualize-frame" id="b8d76366-f724-4ac4-820b-62d3268dd9e3" name="b8d76366-f724-4ac4-820b-62d3268dd9e3" allow="fullscreen 'none'; payment 'none';" sandbox="allow-same-origin allow-forms allow-scripts" srcdoc="
          <html>
            <head>
              <meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src 'none'; script-src http: https: 'unsafe-inline'; style-src http: https: 'unsafe-inline' ; img-src http: https: data:; font-src http: https:; connect-src http: https:; media-src http: https:; object-src 'none'; child-src 'none'; frame-src 'none'&quot;>
              <style>
                html {
                  background: #fff;
                }
              </style>
              <script type=&quot;text/javascript&quot;>
                const id = window.name;
                const parent = window.parent;
                const namespace = 'visualizerFrame';
                const dataMap = {};
                window.pm = {};
                window.pm['getData'] = function(cb) {
                console.log(dataMap[id],'dataMap[id]')
                  if(typeof cb === 'function' &amp;&amp; dataMap[id]) {
                    const { error, data } = dataMap[id]
                    console.log(data,'?')
                    cb(error, data)
                  }
                };
                console.log('1')
                window.addEventListener('message', (event) => {
                console.log(event.data)
                                                  console.log(event.data.id , id)
                  if(!(event &amp;&amp; event.data &amp;&amp; event.data.id === id)) return;
                  if(event.data.namespace === namespace){
                  console.log(event.data.data)
                    handleMessage(event.data.data)
                  }
                });

                function handleMessage(data) {
                console.log(data)
                  if(data) {
                    dataMap[id] = data
                  }
                };

                function ping() {
                  parent.postMessage({
                    type: 'getVisualizerContent',
                    id,
                    namespace,
                  }, '*')
                };

                ping();

                // Initialize sandbox
                (function () {
                  function blockMethod(name) {
                    return () => console.error(&quot;Ignored call to '&quot; + name + &quot;()'.&quot;);
                  }

                  window['alert'] = blockMethod('alert'); window['confirm'] = blockMethod('confirm'); window['print'] = blockMethod('print'); window['prompt'] = blockMethod('prompt');
                  delete window['Worker']; window['Worker'] = undefined; delete window['indexedDB']; window['indexedDB'] = undefined;

                  let _navigator = {};
                  for (let key in navigator) {
                    const prop = navigator[key];
                    if (typeof prop !== 'object' &amp;&amp; typeof prop !== 'function') {
                      _navigator[key] = prop;
                    }
                  }
                  delete window.navigator;
                  window.navigator = _navigator;
                })();
              </script>
            </head>
            <body>

<canvas id=&quot;myChart&quot; height=&quot;75&quot;></canvas>

<script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js&quot;></script>

<script>
    // Get DOM element to render the chart in
    var ctx = document.getElementById(&quot;myChart&quot;);

    // Configure Chart JS here.
    // You can customize the options passed to this constructor to
    // make the chart look and behave the way you want
    var myChart = new Chart(ctx, {
        type: &quot;bar&quot;,
        data: {
            labels: [], // We will update this later in pm.getData()
            datasets: [{
                data: [], // We will update this later in pm.getData()

                // Change these colours to customize the chart
                backgroundColor: [&quot;#003f5c&quot;, &quot;#58508d&quot;, &quot;#bc5090&quot;, &quot;#ff6361&quot;, &quot;#ffa600&quot;],
            }]
        },
        options: {
            legend: { display: false },
            title: {
                display: true,
                text: 'Count'
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Items'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Count'
                    }
                }]
            }
        }

    });

    // Access the data passed to pm.visualizer.set() from the JavaScript
    // code of the Visualizer template


    setTimeout(()=>{
        pm.getData(function (err, value) {
    console.log(value,'ssss')
        myChart.data.datasets[0].data = value.data;
        myChart.data.labels = value.labels;
        myChart.update();
    });
    },1000)

</script>
            </body>
          </html>
        "></iframe>

<script>
  setTimeout(()=>{
    const iframe = document.querySelector('.pui-components-http-request-result-visualize-frame-index-visualize-frame')
    // console.log(iframe,'iframe')
    iframe.contentWindow.postMessage({
      type: 'getVisualizerContent',
      namespace:"visualizerFrame",
      id:"b8d76366-f724-4ac4-820b-62d3268dd9e3",
      data:{
        error:null,
        data:{
          "labels": [
            "IO",
            "IS",
            "DO",
            "BI",
            "IL"
          ],
          "data": [
            329,
            700,
            478,
            244,
            697
          ]
        }
      }
    }, '*')
  },500)
</script>
</body>
</html>
